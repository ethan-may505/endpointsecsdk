from oesis_framework import *
from oesis_generic_product import *

METHOD_ID = {
    "WAAPI_MID_GET_RTP_STATE": 1000,
    "WAAPI_MID_GET_DEF_STATE": 1001,
    "WAAPI_MID_GET_THREATS": 1002,
    "WAAPI_MID_UPDATE_DEFINITIONS": 1003,
    "WAAPI_MID_GET_LAST_SCAN_TIME": 1004,
    "WAAPI_MID_ENABLE_RTP": 1005,
    "WAAPI_MID_SCAN": 1006,
    "WAAPI_MID_GET_SCAN_STATE": 1022,
}


class OesisAntimalware(OesisGenericProduct):

    def __init__(self, oesis, sig_id):
        self.oesis = oesis
        self.sig_id = sig_id

    def get_rtp_state(self):
        input = {
            "signature": self.sig_id,
            "method": METHOD_ID["WAAPI_MID_GET_RTP_STATE"]
        }
        rc, json_out = self.oesis.invoke_method(input)
        output = OesisUtils.get_json_value(rc, json_out, ["enabled", "details"])
        return output

    def get_definition_state(self):
        input = {
            "signature": self.sig_id,
            "method": METHOD_ID["WAAPI_MID_GET_DEF_STATE"],
            "timeframe": 3
        }
        rc, json_out = self.oesis.invoke_method(input)
        output = OesisUtils.get_json_value(rc, json_out, ["is_recent", "definitions"])
        return output

    def get_last_scan_time(self):
        input = {
            "signature": self.sig_id,
            "method": METHOD_ID["WAAPI_MID_GET_LAST_SCAN_TIME"],
            "scan_type": "full"
        }
        rc, json_out = self.oesis.invoke_method(input)
        output = OesisUtils.get_json_value(rc, json_out, ["scan_type", "scan_time"])
        return output

    def get_scan_state(self):
        input = {
            "signature": self.sig_id,
            "method": METHOD_ID["WAAPI_MID_GET_SCAN_STATE"]
        }
        rc, json_out = self.oesis.invoke_method(input)
        output = OesisUtils.get_json_value(rc, json_out, ["state"])
        return output
