using Newtonsoft.Json.Linq;
using System;
using System.Collections.Generic;
using System.Text;
using System.Text.Json;

namespace sample_code_cs
{
    public class OesisAntimalware : OesisGenericProduct
    {
        private static readonly OesisAntimalware m_instance = new OesisAntimalware();

        public OesisAntimalware() { }

        public static OesisAntimalware instance
        {
            get
            {
                return m_instance;
            }
        }

        public JObject GetRealTimeProtectionState()
        {
            //string json_in = "{\"input\": { \"method\": 1000, \"signature\": " + this.signatureId + " } }";
            string json_in = "";
            Dictionary<string, object> input = new Dictionary<string, object>()
            {
                { "method", 1000 },
                { "signature", this.signatureId }
            };
            OesisUtils.CreateJsonIn(ref json_in, input);
            string json_out;
            JObject result = new JObject();
            int rc = this.oesis.Invoke(json_in, out json_out);
            OesisUtils.GetJsonValues(ref result, rc, json_out, new List<string> { "enabled", "details" });
            return result;
        }

        public JObject GetDefinitionState(int timeframe = 3)
        {
            if(timeframe <= 0)
            {
                timeframe = 3;
            }
            //string json_in = "{\"input\": { \"method\": 1001, \"signature\": " + this.signatureId + ",  \"timeframe\": " + timeframe + " } }";
            string json_in = "";
            Dictionary<string, object> input = new Dictionary<string, object>()
            {
                { "method", 1001 },
                { "signature", this.signatureId },
                { "timeframe", timeframe }
            };
            OesisUtils.CreateJsonIn(ref json_in, input);
            string json_out;
            JObject result = new JObject();
            int rc = this.oesis.Invoke(json_in, out json_out);
            OesisUtils.GetJsonValues(ref result, rc, json_out, new List<string> { "is_recent", "definitions"});
            return result;
        }

        public JObject GetLastScanTime(string scan_type = "default")
        {
            //string json_in = "{\"input\": { \"method\": 1004, \"signature\": " + this.signatureId + ",  \"scan_type\": \""+ scan_type +"\" } }";
            string json_in = "";
            Dictionary<string, object> input = new Dictionary<string, object>()
            {
                { "method", 1000 },
                { "signature", this.signatureId },
                { "scan_type", scan_type }
            };
            OesisUtils.CreateJsonIn(ref json_in, input);
            string json_out;
            JObject result = new JObject();
            int rc = this.oesis.Invoke(json_in, out json_out);
            OesisUtils.GetJsonValues(ref result, rc, json_out, new List<string> { "scan_time", "scan_type"});
            return result;
        }

        public JObject GetThreats()
        {
            //string json_in = "{\"input\": { \"method\": 1002, \"signature\": " + this.signatureId + " } }";
            string json_in = "";
            Dictionary<string, object> input = new Dictionary<string, object>()
            {
                { "method", 1002 },
                { "signature", this.signatureId }
            };
            OesisUtils.CreateJsonIn(ref json_in, input);
            string json_out;
            JObject result = new JObject();
            int rc = this.oesis.Invoke(json_in, out json_out);
            OesisUtils.GetJsonValues(ref result, rc, json_out, new List<string> {"last_threat_time", "no_threats", "threats"});
            return result;
        }

        public JObject GetScanState()
        {
            //string json_in = "{\"input\": { \"method\": 1022, \"signature\": " + this.signatureId + " } }";
            string json_in = "";
            Dictionary<string, object> input = new Dictionary<string, object>()
            {
                { "method", 1022 },
                { "signature", this.signatureId }
            };
            OesisUtils.CreateJsonIn(ref json_in, input);
            string json_out;
            JObject result = new JObject();
            int rc = this.oesis.Invoke(json_in, out json_out);
            OesisUtils.GetJsonValues(ref result, rc, json_out, new List<string> { "state" });
            return result;
        }

        public JObject EnableRTP()
        {
            //string json_in = "{\"input\": { \"method\": 1005, \"signature\": " + this.signatureId + " } }";
            string json_in = "";
            Dictionary<string, object> input = new Dictionary<string, object>()
            {
                { "method", 1005 },
                { "signature", this.signatureId }
            };
            OesisUtils.CreateJsonIn(ref json_in, input);
            string json_out;
            JObject result = new JObject();
            int rc = this.oesis.Invoke(json_in, out json_out);
            OesisUtils.GetJsonValues(ref result, rc, json_out, new List<string>{});
            return result;
        }

        public JObject UpdateDefinitions()
        {
            //string json_in = "{\"input\": { \"method\": 1003, \"signature\": " + this.signatureId + " } }";
            string json_in = "";
            Dictionary<string, object> input = new Dictionary<string, object>()
            {
                { "method", 1003 },
                { "signature", this.signatureId }
            };
            OesisUtils.CreateJsonIn(ref json_in, input);
            string json_out;
            JObject result = new JObject();
            int rc = this.oesis.Invoke(json_in, out json_out);
            OesisUtils.GetJsonValues(ref result, rc, json_out, new List<string>{});
            return result;
        }

        public JObject Scan(string scan_type, string path, bool clean = false)
        {
            //string json_in = "{\"input\": { \"method\": 1006, \"signature\": " + this.signatureId + ", \"scan_type\": "+ scan_type + ", \"path\": "+ path +", \"clean\": "+ clean + "} }";
            string json_in = "";
            Dictionary<string, object> input = new Dictionary<string, object>()
            {
                { "method", 1006 },
                { "signature", this.signatureId },
                { "scan_type", scan_type }
            };
            if(scan_type == "path")
            {
                input.Add("path", path);
            }
            if(clean)
            {
                input.Add("clean", true);
            }
            OesisUtils.CreateJsonIn(ref json_in, input);
            string json_out;
            JObject result = new JObject();
            int rc = this.oesis.Invoke(json_in, out json_out);
            OesisUtils.GetJsonValues(ref result, rc, json_out, new List<string>{});
            return result;
        }
    }
}
